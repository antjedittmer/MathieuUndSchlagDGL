<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Frequency_Peters</title>
<meta name="generator" content="MATLAB 26.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-11-17">
<meta name="DC.source" content="Frequency_Peters.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<pre class="codeinput">
<span class="comment">% function Frequency_Peters</span>
<span class="comment">% Floquet Frequency Plot for Mathieu's Equation (Figure 2 Appearance)</span>
<span class="comment">% Separates branches according to the integer multiple 'm' used.</span>
<span class="comment">%</span>
<span class="comment">% Based on:</span>
<span class="comment">% David A. Peters, Sydnie M. Lieb, Loren A. Ahaus</span>
<span class="comment">% "Interpretation of Floquet Eigenvalues and Eigenvectors for Periodic Systems"</span>
<span class="comment">% JOURNAL OF THE AMERICAN HELICOPTER SOCIETY 56, 032001 (2011)</span>
clear; clc; close <span class="string">all</span>;

<span class="comment">% --- Setup for Figure Saving ---</span>
fDir = <span class="string">'figureFolder'</span>; <span class="comment">% Folder for figures</span>
<span class="keyword">if</span> ~isdir(fDir) <span class="comment">%#ok&lt;ISDIR&gt;</span>
    mkdir(fDir)
<span class="keyword">end</span>
fDirPeters = fullfile(fDir,<span class="string">'figureFolderPeters'</span>); <span class="comment">% Subfolder specific to Peters' plots</span>
<span class="keyword">if</span> ~isdir(fDirPeters) <span class="comment">%#ok&lt;ISDIR&gt;</span>
    mkdir(fDirPeters)
<span class="keyword">end</span>
<span class="comment">% Plotting style selection</span>
K = <span class="string">'ColoredLines'</span>;
<span class="comment">% K = 'BlackLines';</span>
useK = strcmp(K,<span class="string">'BlackLines'</span>);

<span class="comment">% -----------------------------------------------------------------------</span>
<span class="comment">% --- Parameters and Initialization ---</span>
<span class="comment">% -----------------------------------------------------------------------</span>
Omega = 1;       <span class="comment">% Fundamental frequency (Omega = 1 rad/s)</span>
T = 2*pi/Omega; <span class="comment">% Period</span>
<span class="comment">% Outer loop for different unperturbed frequencies (w)</span>
w_values = [0.3, 0.5, 0.7];
<span class="keyword">for</span> w = w_values
    w_sq = w^2;
    <span class="comment">% --- Basis Frequency omega0 Calculation (Peters' Convention) ---</span>
    <span class="comment">% The basis frequency, omega0, must satisfy 0 &lt;= omega0 &lt;= Omega/2.</span>
    basis_freq = mod(w, Omega);
    <span class="keyword">if</span> basis_freq &gt; Omega/2
        basis_freq = Omega - basis_freq;
    <span class="keyword">end</span>
    omega0 = basis_freq;

    <span class="comment">% Filename generation for saving the plot</span>
    pngname = strrep(sprintf(<span class="string">'PetersFrequency%s_w%1.1f'</span>,K,w),<span class="string">'.'</span>,<span class="string">'dot'</span>);
    pngfile = fullfile(fDirPeters,[pngname,<span class="string">'.png'</span>]);

    <span class="comment">% Determine the range of epsilon (x-axis limit)</span>
    <span class="keyword">if</span> abs(w - 0.3) &lt; 0.001
        eps_end = 5;
        eps_no = 1000; <span class="comment">% High resolution for w=0.3</span>
    <span class="keyword">elseif</span> abs(w - 0.7) &lt; 0.001
        eps_end = 3.5; <span class="comment">% Axis limit for w=0.7 plot</span>
        eps_no = 150;
    <span class="keyword">else</span> <span class="comment">% Case for w=0.5 and others</span>
        eps_end = 3.5;
        eps_no = 150;
    <span class="keyword">end</span>
    eps_vals = linspace(0, eps_end, eps_no);
    m_range = (-4:4); <span class="comment">% Integer multiple range for plotting branches (m*Omega)</span>

    <span class="comment">% Structure to hold results, organized by branch 'm' (e.g., m_0, m_neg_1)</span>
    results_by_branch = struct();
    <span class="keyword">for</span> m = m_range
        <span class="comment">% Create a valid field name (MATLAB field names cannot start with a sign)</span>
        <span class="keyword">if</span> m &lt; 0
            field_name = [<span class="string">'m_neg_'</span>, num2str(abs(m))];
        <span class="keyword">else</span>
            field_name = [<span class="string">'m_'</span>, num2str(m)];
        <span class="keyword">end</span>
        results_by_branch.(field_name) = []; <span class="comment">% Initialize with empty array</span>
    <span class="keyword">end</span>

    <span class="comment">% -----------------------------------------------------------------------</span>
    <span class="comment">% --- Floquet Exponent Calculation and Branch Separation ---</span>
    <span class="comment">% -----------------------------------------------------------------------</span>
    x0 = eye(2); <span class="comment">% Initial state matrix for Phi(0) = I</span>
    <span class="keyword">for</span> k = 1:length(eps_vals)
        epsilon = eps_vals(k);
        <span class="comment">% The state matrix D(t) for the ODE (Eq. 1):</span>
        <span class="comment">% dot(x) + (w^2 + epsilon*sin(Omega*t)) * x = 0</span>
        <span class="comment">% State-space form (Eq. 2): d{x}/dt = [D(t)]{x}</span>
        D_func = @(t) [0, 1; -(w_sq + epsilon*sin(t)), 0];
        <span class="comment">% Solve for the Transition Matrix Phi(t): {x(t)}=[Phi(t)]{x(0)} (Eq. 7)</span>
        [~, Phi_t] = ode45(@(t, x) reshape(D_func(t) * reshape(x, 2, 2), 4, 1), [0, T], reshape(x0, 4, 1));
        Phi_T = reshape(Phi_t(end, :), 2, 2); <span class="comment">% Monodromy Matrix at Phi(T)</span>

        <span class="comment">% Calculate Floquet Exponents: eta = log(Lambda) / T, see Eq. 8</span>
        <span class="comment">% [Phi(t)]=[A(t)][&minus;exp(eta_j t)&minus;][A(0)]^&minus;1</span>
        <span class="comment">% [A(0)]^&minus;1[Phi(T)][A(0)]=[&minus;Lambda_j&minus;]=[&minus;exp(eta_j T)&minus;]</span>
        Lambda = eig(Phi_T);
        <span class="comment">% Characteristic Exponent (Eq. 9)</span>
        eta = log(Lambda) / T;
        <span class="comment">% The **real part** of eta (Re(eta)) determines stability.</span>
        <span class="comment">% If Re(eta) &gt; 0, the system is unstable (exponential growth).</span>
        <span class="comment">% The **imaginary part** of eta (Im(eta)) determines the frequency (mu).</span>

        <span class="comment">% Extract the Imaginary Part (normalized frequency, mu*Omega = Im(eta))</span>
        <span class="comment">% omega/Omega = Im(eta)/Omega (where Omega=1, so omega = Im(eta))</span>
        normalized_omega = imag(eta) / Omega;

        <span class="comment">% --- Separate and Store Branches (m) ---</span>
        <span class="comment">% 1. Find the basis frequency (principal value)</span>
        <span class="comment">% This step effectively extracts the fractional part of the frequency,</span>
        <span class="comment">% which corresponds to the base frequency component (omega0/Omega) (Eq. 10).</span>
        basis_freq_r =normalized_omega(1);
        <span class="comment">% 2. Map this base frequency to all possible branches 'm'</span>
        <span class="comment">% The physical frequency omega is defined by omega/Omega = m + mu.</span>
        <span class="comment">% Here, 'm' represents the **integer multiple** of the excitation frequency Omega.</span>

        <span class="comment">% - **Positive m (m&gt;0):** Frequencies omega approx m*Omega + omega_0. These branches generally increase with m.</span>
        <span class="comment">% - **Negative m (m&lt;0):** Frequencies omega approx |m|*Omega - omega_0. These branches approach |m|*Omega from below (or above, depending on convention).</span>

        <span class="keyword">for</span> m = m_range

            <span class="keyword">if</span> m==0
                branch_freq = basis_freq_r;
            <span class="keyword">else</span>
                <span class="comment">% This formula reconstructs the full frequency based on the integer m and basis frequency.</span>
                <span class="comment">% For m &gt; 0, it gives branch_freq = m*Omega + basis_freq_r.</span>
                <span class="comment">% For m &lt; 0, it gives branch_freq = |m|*Omega - basis_freq_r.</span>
                branch_freq = abs(m) *Omega + sign(m) *basis_freq_r;
            <span class="keyword">end</span>
            <span class="comment">% Determine the valid field name</span>
            <span class="keyword">if</span> m &lt; 0
                field_name = [<span class="string">'m_neg_'</span>, num2str(abs(m))];
            <span class="keyword">else</span>
                field_name = [<span class="string">'m_'</span>, num2str(m)];
            <span class="keyword">end</span>
            <span class="comment">% Store [epsilon, frequency] for this specific branch</span>
            results_by_branch.(field_name) = [results_by_branch.(field_name); epsilon, branch_freq];
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% -----------------------------------------------------------------------</span>
    <span class="comment">% --- Plotting ---</span>
    <span class="comment">% -----------------------------------------------------------------------</span>
    figure;
    hold <span class="string">on</span>;
    color_map = lines;
    color_map = [color_map(1:7,:);0*ones(1,3);0.5*ones(1,3)];
    <span class="comment">% Title Update: Includes ODE, w, and Omega definition</span>
    ode_str = <span class="string">'$\dot{x} + (w^2 + \epsilon\sin(\Omega t)) x = 0$'</span>;
    w_str = num2str(w, <span class="string">'%1.1f'</span>);
    new_title = {<span class="string">'Frequency vs. $\epsilon$, '</span>, [ode_str, <span class="string">', $w = '</span>, w_str, <span class="string">'$ ($\Omega = 2\pi$ rad/s)'</span>]};
    title(new_title, <span class="string">'FontSize'</span>, 16, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    xlabel(<span class="string">'$\epsilon$'</span>, <span class="string">'FontSize'</span>, 14, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    ylabel(<span class="string">'Frequency ($\omega/\Omega$)'</span>, <span class="string">'FontSize'</span>, 14, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    idx = 1;
    <span class="keyword">for</span> m = m_range
        <span class="comment">% Determine field name</span>
        <span class="keyword">if</span> m &lt; 0
            field_name = [<span class="string">'m_neg_'</span>, num2str(abs(m))];
        <span class="keyword">else</span>
            field_name = [<span class="string">'m_'</span>, num2str(m)];
        <span class="keyword">end</span>
        <span class="comment">% --- Legend Calculation: Peters' Frequency Convention (FIXED \omega) ---</span>
        <span class="keyword">if</span> m &gt;= 0
            <span class="comment">% omega/Omega approx omega0/Omega + m</span>
            freq_normalized = omega0/Omega + m;
            <span class="comment">% Use \\omega to represent \omega to the LaTeX interpreter</span>
            freq_str = sprintf(<span class="string">'$m=%+d \\rightarrow \\omega/\\Omega \\approx %.1f$'</span>, m, freq_normalized);
        <span class="keyword">elseif</span> m &lt; 0
            <span class="comment">% omega/Omega approx |m| - omega0/Omega</span>
            m_abs = abs(m);
            freq_normalized = m_abs - omega0/Omega;
            <span class="comment">%  Use \\omega to represent \omega to the LaTeX interpreter</span>
            freq_str = sprintf(<span class="string">'$m=%+d \\rightarrow \\omega/\\Omega \\approx %.1f$'</span>, m, freq_normalized);
        <span class="keyword">end</span>
        <span class="comment">% Get data for plotting</span>
        data = results_by_branch.(field_name);
        <span class="comment">% The initial color based on sequential index 'idx'</span>
        current_color = color_map(idx, :);
        <span class="comment">% Plotting using dots/scatters to form the continuous curves</span>
        <span class="keyword">if</span> useK == 1
            plot(data(:, 1), data(:, 2), <span class="string">'.'</span>, <span class="string">'Color'</span>,<span class="string">'k'</span>, <span class="string">'MarkerSize'</span>, 8, <span class="string">'DisplayName'</span>, freq_str);
        <span class="keyword">else</span>
            <span class="comment">% Pass the calculated 'current_color' to the plot function.</span>
            <span class="comment">% This ensures both the line and the legend swatch use the swapped color.</span>
             plot(data(:, 1), data(:, 2), <span class="string">'.'</span>, <span class="string">'Color'</span>, current_color, <span class="string">'MarkerSize'</span>, 8, <span class="string">'DisplayName'</span>, freq_str);
        <span class="keyword">end</span>

        idx = idx + 1;
    <span class="keyword">end</span>
    <span class="comment">% Set Axis limits</span>
    grid <span class="string">on</span>;
    set(gca, <span class="string">'TickLabelInterpreter'</span>, <span class="string">'latex'</span>);
    <span class="comment">% Add Legend if colors are used</span>
    <span class="keyword">if</span> ~useK
        legend(<span class="string">'Location'</span>, <span class="string">'northeastoutside'</span>, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    <span class="keyword">end</span>

    <span class="comment">% -----------------------------------------------------------------------</span>
    <span class="comment">% --- Branch Label Annotations ---</span>
    <span class="comment">% -----------------------------------------------------------------------</span>
    <span class="comment">% These labels mark the primary frequency branches at different regions</span>
    <span class="comment">% of the stability chart.</span>
    hold <span class="string">on</span>;
    <span class="comment">% Left-side labels (ε -&gt; 0)</span>
    text(0.05, 0.08, <span class="string">'[+0]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near w/Omega = 0.7 - 0.5 = 0.2 (using basis freq)</span>
    text(0.05, 0.55, <span class="string">'[-1]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near 1 - 0.3 = 0.7</span>
    text(0.05, 1.08, <span class="string">'[+1]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near 1 + 0.3 = 1.3</span>
    text(0.05, 1.55, <span class="string">'[-2]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near 2 - 0.3 = 1.7</span>
    text(0.05, 2.08, <span class="string">'[+2]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near 2 + 0.3 = 2.3</span>
    text(0.05, 2.55, <span class="string">'[-3]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near 3 - 0.3 = 2.7</span>
    text(0.05, 3.08, <span class="string">'[+3]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near 3 + 0.3 = 3.3</span>
    text(0.05, 3.55, <span class="string">'[-4]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>); <span class="comment">% Near 4 - 0.3 = 3.7</span>
    <span class="comment">% Middle labels (Near the primary instability boundaries)</span>
    text(1.2, 0.35, <span class="string">'[-1/+0]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    text(1.2, 1.35, <span class="string">'[-2/+1]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    text(1.2, 2.35, <span class="string">'[-3/+2]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    text(1.2, 3.35, <span class="string">'[-4/+3]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    <span class="comment">% --- RIGHT-SIDE LABELS (Secondary Instability Boundaries) ---</span>
    <span class="comment">% The labels are positioned based on the value of 'w' used in the analysis.</span>
    <span class="keyword">if</span> abs(w - 0.3) &lt; 0.001
        <span class="comment">% Labels for w = 0.3</span>
        text(4.0, 0.20, <span class="string">'[+0]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(4.0, 1.20, <span class="string">'[-1/+1]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(4.0, 2.20, <span class="string">'[-2/+2]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(4.0, 3.20, <span class="string">'[-3/+3]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(4.0, 4.20, <span class="string">'[-4/+4]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    <span class="keyword">elseif</span> abs(w - 0.7) &lt; 0.001
        <span class="comment">% Labels for w = 0.7</span>
        text(3.0, 0.20, <span class="string">'[+0]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(3.0, 1.20, <span class="string">'[-1/+1]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(3.0, 2.20, <span class="string">'[-2/+2]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(3.0, 3.20, <span class="string">'[-3/+3]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
        text(3.0, 4.20, <span class="string">'[-4/+4]'</span>, <span class="string">'FontSize'</span>, 10, <span class="string">'Interpreter'</span>, <span class="string">'latex'</span>);
    <span class="keyword">end</span>
    <span class="comment">% Print to Png file</span>
    print(pngfile, <span class="string">'-dpng'</span>)
<span class="keyword">end</span>
</pre>
<img vspace="5" hspace="5" src="Frequency_Peters_01.png" alt=""> <img vspace="5" hspace="5" src="Frequency_Peters_02.png" alt=""> <img vspace="5" hspace="5" src="Frequency_Peters_03.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2026a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
% function Frequency_Peters
% Floquet Frequency Plot for Mathieu's Equation (Figure 2 Appearance)
% Separates branches according to the integer multiple 'm' used.
%
% Based on:
% David A. Peters, Sydnie M. Lieb, Loren A. Ahaus
% "Interpretation of Floquet Eigenvalues and Eigenvectors for Periodic Systems"
% JOURNAL OF THE AMERICAN HELICOPTER SOCIETY 56, 032001 (2011)
clear; clc; close all;

% REPLACE_WITH_DASH_DASH- Setup for Figure Saving REPLACE_WITH_DASH_DASH-
fDir = 'figureFolder'; % Folder for figures
if ~isdir(fDir) %#ok<ISDIR>
    mkdir(fDir)
end
fDirPeters = fullfile(fDir,'figureFolderPeters'); % Subfolder specific to Peters' plots
if ~isdir(fDirPeters) %#ok<ISDIR>
    mkdir(fDirPeters)
end
% Plotting style selection
K = 'ColoredLines';
% K = 'BlackLines';
useK = strcmp(K,'BlackLines');

% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
% REPLACE_WITH_DASH_DASH- Parameters and Initialization REPLACE_WITH_DASH_DASH-
% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
Omega = 1;       % Fundamental frequency (Omega = 1 rad/s)
T = 2*pi/Omega; % Period
% Outer loop for different unperturbed frequencies (w)
w_values = [0.3, 0.5, 0.7];
for w = w_values
    w_sq = w^2;
    % REPLACE_WITH_DASH_DASH- Basis Frequency omega0 Calculation (Peters' Convention) REPLACE_WITH_DASH_DASH-
    % The basis frequency, omega0, must satisfy 0 <= omega0 <= Omega/2.
    basis_freq = mod(w, Omega);
    if basis_freq > Omega/2
        basis_freq = Omega - basis_freq;
    end
    omega0 = basis_freq;

    % Filename generation for saving the plot
    pngname = strrep(sprintf('PetersFrequency%s_w%1.1f',K,w),'.','dot');
    pngfile = fullfile(fDirPeters,[pngname,'.png']);

    % Determine the range of epsilon (x-axis limit)
    if abs(w - 0.3) < 0.001
        eps_end = 5;
        eps_no = 1000; % High resolution for w=0.3
    elseif abs(w - 0.7) < 0.001
        eps_end = 3.5; % Axis limit for w=0.7 plot
        eps_no = 150;
    else % Case for w=0.5 and others
        eps_end = 3.5;
        eps_no = 150;
    end
    eps_vals = linspace(0, eps_end, eps_no);
    m_range = (-4:4); % Integer multiple range for plotting branches (m*Omega)
   
    % Structure to hold results, organized by branch 'm' (e.g., m_0, m_neg_1)
    results_by_branch = struct();
    for m = m_range
        % Create a valid field name (MATLAB field names cannot start with a sign)
        if m < 0
            field_name = ['m_neg_', num2str(abs(m))];
        else
            field_name = ['m_', num2str(m)];
        end
        results_by_branch.(field_name) = []; % Initialize with empty array
    end

    % REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    % REPLACE_WITH_DASH_DASH- Floquet Exponent Calculation and Branch Separation REPLACE_WITH_DASH_DASH-
    % REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    x0 = eye(2); % Initial state matrix for Phi(0) = I
    for k = 1:length(eps_vals)
        epsilon = eps_vals(k);
        % The state matrix D(t) for the ODE (Eq. 1):
        % dot(x) + (w^2 + epsilon*sin(Omega*t)) * x = 0
        % State-space form (Eq. 2): d{x}/dt = [D(t)]{x}
        D_func = @(t) [0, 1; -(w_sq + epsilon*sin(t)), 0];
        % Solve for the Transition Matrix Phi(t): {x(t)}=[Phi(t)]{x(0)} (Eq. 7)
        [~, Phi_t] = ode45(@(t, x) reshape(D_func(t) * reshape(x, 2, 2), 4, 1), [0, T], reshape(x0, 4, 1));
        Phi_T = reshape(Phi_t(end, :), 2, 2); % Monodromy Matrix at Phi(T)
       
        % Calculate Floquet Exponents: eta = log(Lambda) / T, see Eq. 8
        % [Phi(t)]=[A(t)][−exp(eta_j t)−][A(0)]^−1
        % [A(0)]^−1[Phi(T)][A(0)]=[−Lambda_j−]=[−exp(eta_j T)−]
        Lambda = eig(Phi_T);
        % Characteristic Exponent (Eq. 9)
        eta = log(Lambda) / T;
        % The **real part** of eta (Re(eta)) determines stability.
        % If Re(eta) > 0, the system is unstable (exponential growth).
        % The **imaginary part** of eta (Im(eta)) determines the frequency (mu).
     
        % Extract the Imaginary Part (normalized frequency, mu*Omega = Im(eta))
        % omega/Omega = Im(eta)/Omega (where Omega=1, so omega = Im(eta))
        normalized_omega = imag(eta) / Omega;

        % REPLACE_WITH_DASH_DASH- Separate and Store Branches (m) REPLACE_WITH_DASH_DASH-
        % 1. Find the basis frequency (principal value)
        % This step effectively extracts the fractional part of the frequency,
        % which corresponds to the base frequency component (omega0/Omega) (Eq. 10).
        basis_freq_r =normalized_omega(1);
        % 2. Map this base frequency to all possible branches 'm'
        % The physical frequency omega is defined by omega/Omega = m + mu.
        % Here, 'm' represents the **integer multiple** of the excitation frequency Omega.

        % - **Positive m (m>0):** Frequencies omega approx m*Omega + omega_0. These branches generally increase with m.
        % - **Negative m (m<0):** Frequencies omega approx |m|*Omega - omega_0. These branches approach |m|*Omega from below (or above, depending on convention).

        for m = m_range

            if m==0
                branch_freq = basis_freq_r;
            else
                % This formula reconstructs the full frequency based on the integer m and basis frequency.
                % For m > 0, it gives branch_freq = m*Omega + basis_freq_r.
                % For m < 0, it gives branch_freq = |m|*Omega - basis_freq_r.
                branch_freq = abs(m) *Omega + sign(m) *basis_freq_r;
            end
            % Determine the valid field name
            if m < 0
                field_name = ['m_neg_', num2str(abs(m))];
            else
                field_name = ['m_', num2str(m)];
            end
            % Store [epsilon, frequency] for this specific branch
            results_by_branch.(field_name) = [results_by_branch.(field_name); epsilon, branch_freq];
        end
    end
    
    % REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    % REPLACE_WITH_DASH_DASH- Plotting REPLACE_WITH_DASH_DASH-
    % REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    figure;
    hold on;
    color_map = lines;
    color_map = [color_map(1:7,:);0*ones(1,3);0.5*ones(1,3)];
    % Title Update: Includes ODE, w, and Omega definition
    ode_str = '$\dot{x} + (w^2 + \epsilon\sin(\Omega t)) x = 0$';
    w_str = num2str(w, '%1.1f');
    new_title = {'Frequency vs. $\epsilon$, ', [ode_str, ', $w = ', w_str, '$ ($\Omega = 2\pi$ rad/s)']};
    title(new_title, 'FontSize', 16, 'Interpreter', 'latex');
    xlabel('$\epsilon$', 'FontSize', 14, 'Interpreter', 'latex');
    ylabel('Frequency ($\omega/\Omega$)', 'FontSize', 14, 'Interpreter', 'latex');
    idx = 1;
    for m = m_range
        % Determine field name
        if m < 0
            field_name = ['m_neg_', num2str(abs(m))];
        else
            field_name = ['m_', num2str(m)];
        end
        % REPLACE_WITH_DASH_DASH- Legend Calculation: Peters' Frequency Convention (FIXED \omega) REPLACE_WITH_DASH_DASH-
        if m >= 0
            % omega/Omega approx omega0/Omega + m
            freq_normalized = omega0/Omega + m;
            % Use \\omega to represent \omega to the LaTeX interpreter
            freq_str = sprintf('$m=%+d \\rightarrow \\omega/\\Omega \\approx %.1f$', m, freq_normalized);
        elseif m < 0
            % omega/Omega approx |m| - omega0/Omega
            m_abs = abs(m);
            freq_normalized = m_abs - omega0/Omega;
            %  Use \\omega to represent \omega to the LaTeX interpreter
            freq_str = sprintf('$m=%+d \\rightarrow \\omega/\\Omega \\approx %.1f$', m, freq_normalized);
        end
        % Get data for plotting
        data = results_by_branch.(field_name);
        % The initial color based on sequential index 'idx'
        current_color = color_map(idx, :);
        % Plotting using dots/scatters to form the continuous curves
        if useK == 1
            plot(data(:, 1), data(:, 2), '.', 'Color','k', 'MarkerSize', 8, 'DisplayName', freq_str);
        else
            % Pass the calculated 'current_color' to the plot function.
            % This ensures both the line and the legend swatch use the swapped color.
             plot(data(:, 1), data(:, 2), '.', 'Color', current_color, 'MarkerSize', 8, 'DisplayName', freq_str);
        end

        idx = idx + 1;
    end
    % Set Axis limits
    grid on;
    set(gca, 'TickLabelInterpreter', 'latex');
    % Add Legend if colors are used
    if ~useK
        legend('Location', 'northeastoutside', 'Interpreter', 'latex');
    end
   
    % REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    % REPLACE_WITH_DASH_DASH- Branch Label Annotations REPLACE_WITH_DASH_DASH-
    % REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    % These labels mark the primary frequency branches at different regions
    % of the stability chart.
    hold on;
    % Left-side labels (ε -> 0)
    text(0.05, 0.08, '[+0]', 'FontSize', 10, 'Interpreter', 'latex'); % Near w/Omega = 0.7 - 0.5 = 0.2 (using basis freq)
    text(0.05, 0.55, '[-1]', 'FontSize', 10, 'Interpreter', 'latex'); % Near 1 - 0.3 = 0.7
    text(0.05, 1.08, '[+1]', 'FontSize', 10, 'Interpreter', 'latex'); % Near 1 + 0.3 = 1.3
    text(0.05, 1.55, '[-2]', 'FontSize', 10, 'Interpreter', 'latex'); % Near 2 - 0.3 = 1.7
    text(0.05, 2.08, '[+2]', 'FontSize', 10, 'Interpreter', 'latex'); % Near 2 + 0.3 = 2.3
    text(0.05, 2.55, '[-3]', 'FontSize', 10, 'Interpreter', 'latex'); % Near 3 - 0.3 = 2.7
    text(0.05, 3.08, '[+3]', 'FontSize', 10, 'Interpreter', 'latex'); % Near 3 + 0.3 = 3.3
    text(0.05, 3.55, '[-4]', 'FontSize', 10, 'Interpreter', 'latex'); % Near 4 - 0.3 = 3.7
    % Middle labels (Near the primary instability boundaries)
    text(1.2, 0.35, '[-1/+0]', 'FontSize', 10, 'Interpreter', 'latex');
    text(1.2, 1.35, '[-2/+1]', 'FontSize', 10, 'Interpreter', 'latex');
    text(1.2, 2.35, '[-3/+2]', 'FontSize', 10, 'Interpreter', 'latex');
    text(1.2, 3.35, '[-4/+3]', 'FontSize', 10, 'Interpreter', 'latex');
    % REPLACE_WITH_DASH_DASH- RIGHT-SIDE LABELS (Secondary Instability Boundaries) REPLACE_WITH_DASH_DASH-
    % The labels are positioned based on the value of 'w' used in the analysis.
    if abs(w - 0.3) < 0.001
        % Labels for w = 0.3
        text(4.0, 0.20, '[+0]', 'FontSize', 10, 'Interpreter', 'latex');
        text(4.0, 1.20, '[-1/+1]', 'FontSize', 10, 'Interpreter', 'latex');
        text(4.0, 2.20, '[-2/+2]', 'FontSize', 10, 'Interpreter', 'latex');
        text(4.0, 3.20, '[-3/+3]', 'FontSize', 10, 'Interpreter', 'latex');
        text(4.0, 4.20, '[-4/+4]', 'FontSize', 10, 'Interpreter', 'latex');
    elseif abs(w - 0.7) < 0.001
        % Labels for w = 0.7
        text(3.0, 0.20, '[+0]', 'FontSize', 10, 'Interpreter', 'latex');
        text(3.0, 1.20, '[-1/+1]', 'FontSize', 10, 'Interpreter', 'latex');
        text(3.0, 2.20, '[-2/+2]', 'FontSize', 10, 'Interpreter', 'latex');
        text(3.0, 3.20, '[-3/+3]', 'FontSize', 10, 'Interpreter', 'latex');
        text(3.0, 4.20, '[-4/+4]', 'FontSize', 10, 'Interpreter', 'latex');
    end
    % Print to Png file
    print(pngfile, '-dpng')
end
##### SOURCE END #####
-->
</body>
</html>
